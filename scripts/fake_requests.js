var udp = require('dgram');

var socket = udp.createSocket('udp4');

var port = process.env.UDP_PORT || 6306;
var delay = 500;

var locations = [[-86.2254,32.26050000000001],[-85.0635,41.09960000000001],[-73.8769,40.84989999999999],[-70.979,42.72460000000001],[-122.27080000000001,37.80439999999999],[-98.3586,30.219799999999992],[-82.1648,33.557799999999986],[-91.516,36.297799999999995],[-95.965,41.24000000000001],[-84.1399,40.57669999999999],[-104.8214,38.8339],[-100.8057,35.43639999999999],[-83.3527,42.36840000000001],[-122.3073,47.7936],[-81.8443,32.37289999999999],[-97,38],[-82.0967,29.165400000000005],[-97,38],[-90.4245,38.57759999999999],[-83.5983,39.9631],[-75.2931,40.226200000000006],[-122.7041,38.3433],[-118.2551,34.14250000000001],[-79.4596,39.77279999999999],[-116.995,32.71700000000001],[-87.5559,37.97479999999999],[-98.4936,29.42410000000001],[-72.6557,41.92349999999999],[-111.9093,33.414800000000014],[-96.2062,41.799800000000005],[-93.2021,44.74680000000001],[-83.3897,33.76939999999999],[-97.7278,31.117099999999994],[-80.8431,35.22710000000001],[-89.3569,44.659400000000005],[-93.9962,38.74010000000001],[-79.422,40.80760000000001],[-81.628,41.0232],[-96.8067,32.78309999999999],[-97,38],[-71.4484,42.65899999999999],[-97,38],[-110.9265,32.2217],[-84.5255,42.7422],[-97,38],[-97,38],[-85.8316,33.65979999999999],[-84.0659,41.893400000000014],[-74.4637,40.55160000000001],[-80.9956,29.138299999999987],[-82.8591,40.489599999999996],[-75.5471,40.6841],[-97,38],[-71.4958,42.730500000000006],[-91.1546,30.450700000000012],[-81.3412,35.73320000000001],[-80.5207,39.05090000000001],[-95.3633,29.763299999999987],[-75.3861,42.287499999999994],[-97.9298,38.0608],[-75.1607,40.15180000000001],[-75.3705,40.6259],[-85.0056,34.7381],[-112.0118,34.75819999999999],[-77.6259,39.316900000000004],[-75.4423,39.884600000000006],[-94.1611,30.461099999999988],[-73.8769,40.84989999999999],[-90.1979,38.62729999999999],[-95.3633,29.763299999999987],[-104.9059,41.10339999999999],[-97,38],[-80.3223,36.09780000000001],[-119.5634,36.9358],[-88.0105,43.57169999999999],[-75.0479,39.97200000000001],[-118.2302,34.21209999999999],[-121.5253,37.50380000000001],[-83.5983,39.9631],[-101.8552,33.5779],[-81.3397,28.757800000000003],[-90.1979,38.62729999999999],[-77.9122,35.3673],[-84.6715,37.84479999999999],[-89.7812,30.275200000000012],[-97.6475,31.105999999999995],[-77.4146,35.512699999999995],[-97,38],[-111.8226,33.42230000000001],[-97,38],[-76.7677,34.73859999999999],[-94.7057,38.18610000000001],[-93.4017,45.18029999999999],[-97,38],[-94.4808,43.63650000000001],[-97,38],[-98.3652,29.55590000000001],[-105.0867,39.920500000000004],[-97,38],[-74.0288,40.623400000000004],[-97,38],[-88.9873,42.30959999999999],[-71.7657,42.524400000000014],[-81.0237,34.88890000000001],[-97,38],[-84.6715,37.84479999999999],[-97,38],[-83.5983,39.9631],[-82.3024,27.900299999999987],[-79.9414,37.27099999999999],[-85.9817,40.06979999999999],[-91.2272,44.0069],[-85.5459,38.2552],[-82.1648,33.557799999999986],[-73.8434,40.844899999999996],[-116.9119,47.5924],[-81.1276,38.81530000000001],[-97.7431,30.267200000000003],[-87.2591,37.7662],[-78.3434,34.98609999999999],[-110.6038,45.8869],[-95.6161,30.097199999999987],[-80.8348,36.518],[-101.5961,35.58949999999999],[-97,38],[-97,38],[-90.7974,29.80279999999999],[-90.1979,38.62729999999999],[-75.978,36.852900000000005],[-82.6596,28.2158],[-91.1286,43.79820000000001],[-84.4777,37.988699999999994]];

function getFakeDatapoint() {
  var location = locations[Math.floor(Math.random() * locations.length)];

  var data = {
    "ip":"74.130.228.99",
    "offer":"3585b8da3f5011e4a11a12313f063e60",
    "user_id":"dc5f5b34-2690-4cbb-eb5e-9e1b3090a3e2",
    "@version":"1",
    "@timestamp":"2014-09-20T02:11:57.681Z",
    "type":"offer_served",
    "client_ip":"74.130.228.99",
    "geoip":{
      "country_code2":"US",
      "country_name":"United States",
      "city_name":"Louisville",
      "longitude": location[0],
      "latitude": location[1],
      "timezone":"America/New_York",
      "location": location
      },
    "tags":["geo"],
    "timestamp":"2014-09-20 02:11:57"
  };

  return data;
}

setInterval(function() {
  var data = getFakeDatapoint();
  var json = new Buffer(JSON.stringify(data));

  socket.send(json, 0, json.length, 6306, 'localhost', function() {
    console.log('Sent: ' + json);
  });
}, delay);
